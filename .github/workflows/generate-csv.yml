name: Generate and Publish CSV at 18:40

on:
  schedule:
    # Î¤ÏÎ­Ï‡ÎµÎ¹ ÎºÎ¬Î¸Îµ Î¼Î­ÏÎ± ÏƒÏ„Î¹Ï‚ 16:40 UTC = 18:40 Î•Î»Î»Î¬Î´Î±
    - cron: '48 16 * * *'
    
  workflow_dispatch:  # Î“Î¹Î± Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ·

jobs:
  generate-csv:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # Î‘Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿ Î³Î¹Î± v4
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4  # Î•Î½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î¿ ÎºÎ±Î¹ Î±Ï…Ï„ÏŒ
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas
        
    - name: Generate CSV with Greek data
      run: |
        cat > generate_csv.py << 'EOF'
import pandas as pd
import datetime

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î•Î»Î»Î·Î½Î¹ÎºÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
data = {
    'Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±': [datetime.datetime.now().strftime('%d/%m/%Y %H:%M')],
    'Î•Ï„Î±Î¹ÏÎµÎ¯Î±': ['Î•Î»Î»Î·Î½Î¹ÎºÎ® Î•Ï„Î±Î¹ÏÎµÎ¯Î± Î‘Î•'],
    'Î ÎµÎ»Î¬Ï„Î·Ï‚': ['Î“ÎµÏÏÎ³Î¹Î¿Ï‚ Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚'],
    'Î ÏŒÎ»Î·': ['Î‘Î¸Î®Î½Î±'],
    'Î Î¿ÏƒÏŒ': [1250.75],
    'ÎÏŒÎ¼Î¹ÏƒÎ¼Î±': ['EUR'],
    'ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·': ['ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î·']
}

df = pd.DataFrame(data)
# UTF-8 Î¼Îµ BOM Î³Î¹Î± ÏƒÏ‰ÏƒÏ„Î¬ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬ ÏƒÏ„Î¿ Excel
df.to_csv('data.csv', index=False, encoding='utf-8-sig')
print("âœ… CSV Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!")
print(f"â° ÎÏÎ± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚: {datetime.datetime.now()}")
EOF
        
        python generate_csv.py
        
    - name: Upload CSV as Artifact
      uses: actions/upload-artifact@v4  # Î‘Î¥Î¤ÎŸ Î•Î™ÎÎ‘Î™ Î— Î”Î™ÎŸÎ¡Î˜Î©Î£Î—!
      with:
        name: daily-csv-report
        path: data.csv
        
    - name: Display file info
      run: |
        echo "ğŸ“Š Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï…:"
        ls -la data.csv
        echo "--- Î ÏÏÏ„ÎµÏ‚ 5 Î³ÏÎ±Î¼Î¼Î­Ï‚ ---"
        head -5 data.csv
        
    - name: Verify execution time (Optional)
      run: |
        echo "ğŸ•’ UTC Time: $(date -u '+%H:%M')"
        echo "ğŸ‡¬ğŸ‡· Greece Time: $(TZ='Europe/Athens' date '+%H:%M')"
